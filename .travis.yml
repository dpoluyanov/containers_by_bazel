sudo: required
dist: trusty
language: generic
before_install:
  - sudo apt-get update
  - sudo apt-get install -y --no-install-recommends apt-transport-https ca-certificates
  # java
  - sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys 0x219BD9C9
  - sudo sh -c 'echo "deb http://repos.azulsystems.com/ubuntu stable main" > /etc/apt/sources.list.d/zulu.list'
  - sudo apt-get update
  - sudo apt-get install -y --no-install-recommends zulu-8=8.19.0.1
  - java -version
  # docker
  - sudo apt-key adv --keyserver hkp://p80.pool.sks-keyservers.net:80 --recv-keys 58118E89F3A912897C070ADBF76221572C52609D
  - sudo sh -c 'echo "deb https://apt.dockerproject.org/repo ubuntu-trusty main" > /etc/apt/sources.list.d/docker.list'
  - sudo apt-get update
  - sudo apt-get purge docker-engine || true
  - sudo apt-get install -y --no-install-recommends docker-engine=1.12.5-0~ubuntu-trusty
  - sudo usermod -aG docker $USER
  - docker -v
  # bazel
  - echo "deb [arch=amd64] http://storage.googleapis.com/bazel-apt stable jdk1.8" | sudo tee /etc/apt/sources.list.d/bazel.list
  - curl https://bazel.build/bazel-release.pub.gpg | sudo apt-key add -
  - sudo apt-get update
  - sudo apt-get install bazel
  - bazel version
install:
before_script:
  # TODO fix sandboxing  --sandbox_debug
  - echo 'test --genrule_strategy=standalone --spawn_strategy=standalone' >> ~/.bazelrc
script:
  - bazel fetch //test/... || true
  - bazel test --verbose_failures //test/...
after_script:
addons:
  artifacts:
    paths:
      - bazel-testlogs/
    target_paths: $TRAVIS_BUILD_NUMBER
    working_dir: WORKING_DIR
